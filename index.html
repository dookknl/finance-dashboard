<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>ê¸ˆìœµ ëŒ€ì‹œë³´ë“œ</title>

Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script>
Â  Â  tailwind.config = {
Â  Â  Â  theme: {
Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  boxShadow: {
Â  Â  Â  Â  Â  Â  soft: '0 10px 30px rgba(0,0,0,0.06)'
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  },
Â  Â  Â  darkMode: 'class'
Â  Â  }
Â  </script>
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

Â  <style>
Â  Â  body { font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif; }
Â  Â  .card-details { transition: max-height .3s ease, opacity .3s ease; max-height: 0; overflow: hidden; opacity: 0; }
Â  Â  .card-details.visible { max-height: 260px; opacity: 1; }
Â  Â  .skeleton { background: linear-gradient(90deg, rgba(0,0,0,0.06), rgba(0,0,0,0.12), rgba(0,0,0,0.06)); background-size: 200% 100%; animation: shimmer 1.2s infinite; }
Â  Â  @keyframes shimmer { from { background-position: 200% 0;} to { background-position: -200% 0;} }
Â  Â  @media (min-width: 1024px) { .main-container { min-height: 100vh; } }
Â  </style>
</head>
<body class="h-full bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100">
Â  <div class="main-container mx-auto max-w-7xl p-4 sm:p-6 lg:p-10">
Â  Â  <div class="flex items-center gap-3 mb-6">
Â  Â  Â  <div class="flex items-center gap-3">
Â  Â  Â  Â  <div id="person-icon" class="w-11 h-11 rounded-2xl bg-indigo-600 text-white grid place-items-center shadow-soft"></div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h1 id="dashboard-title" class="text-2xl sm:text-3xl font-extrabold" data-i18n="dashboardTitle"></h1>
Â  Â  Â  Â  Â  <p id="last-updated" class="text-xs text-slate-500 dark:text-slate-400" data-i18n="lastUpdated"></p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="ml-auto flex items-center gap-2">
Â  Â  Â  Â  <select id="person-select" class="px-3 py-2 rounded-xl text-sm bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/70 shadow-soft"></select>
Â  Â  Â  Â  <select id="lang-select" class="px-3 py-2 rounded-xl text-sm bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/70 shadow-soft">
Â  Â  Â  Â  Â  <option value="ko">í•œ</option>
Â  Â  Â  Â  Â  <option value="en">E</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <button id="toggleTheme" class="px-3 py-2 rounded-xl text-sm bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/70 shadow-soft" title="ë¼ì´íŠ¸/ë‹¤í¬ ì „í™˜">ğŸŒ—</button>
Â  Â  Â  Â  <button id="fullscreen-button" class="px-3 py-2 rounded-xl text-sm bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/70 shadow-soft" title="ì „ì²´ í™”ë©´">â›¶</button>
Â  Â  Â  Â  <button id="toggle-auto" class="px-3 py-2 rounded-xl text-sm bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/70 shadow-soft" title="ìë™ ì „í™˜">â–¶ï¸</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="status-banner" class="hidden mb-4 rounded-2xl border px-4 py-3 text-sm"></div>

Â  Â  <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
Â  Â  Â  <div class="kpi bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <div class="text-sm text-slate-500 dark:text-slate-400" data-i18n="kpiTotalLabel"></div>
Â  Â  Â  Â  <div id="kpi-total" class="text-3xl font-extrabold mt-1 tracking-tight">â‚©0</div>
Â  Â  Â  Â  <div id="kpi-total-mm" class="text-xs text-slate-500 mt-1">â‚©0.00 MM</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <div class="text-sm text-slate-500 dark:text-slate-400" data-i18n="kpiProfitLossLabel"></div>
Â  Â  Â  Â  <div id="kpi-pl" class="text-3xl font-extrabold mt-1 tracking-tight">â‚©0</div>
Â  Â  Â  Â  <div id="kpi-pl-rate" class="text-xs mt-1">â€”</div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <div class="text-sm text-slate-500 dark:text-slate-400" data-i18n="kpiCashLabel"></div>
Â  Â  Â  Â  <div id="kpi-cash" class="text-3xl font-extrabold mt-1 tracking-tight">â‚©0</div>
Â  Â  Â  Â  <div class="text-xs text-slate-500 mt-1" data-i18n="kpiCashSubLabel"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="kpi bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <div class="text-sm text-slate-500 dark:text-slate-400" data-i18n="kpiCountLabel"></div>
Â  Â  Â  Â  <div id="kpi-count" class="text-3xl font-extrabold mt-1 tracking-tight">0</div>
Â  Â  Â  Â  <div class="text-xs text-slate-500 mt-1" data-i18n="kpiCountSubLabel"></div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
Â  Â  Â  <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <h2 class="text-lg font-bold mb-4" data-i18n="assetAllocationTitle"></h2>
Â  Â  Â  Â  <div class="h-[320px]"><canvas id="donut"></canvas></div>
Â  Â  Â  Â  </div>
Â  Â  Â  <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <h2 class="text-lg font-bold mb-4" data-i18n="profitLossByAssetTitle"></h2>
Â  Â  Â  Â  <div class="h-[320px]"><canvas id="bars"></canvas></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-soft border border-slate-100 dark:border-slate-800">
Â  Â  Â  Â  <div class="flex items-center gap-2 mb-4">
Â  Â  Â  Â  Â  <h2 class="text-lg font-bold" data-i18n="portfolioTrendTitle"></h2>
Â  Â  Â  Â  Â  <span id="timeline-badge" class="ml-2 text-[10px] px-2 py-0.5 rounded-full border border-slate-200 dark:border-slate-700 text-slate-500"></span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="h-[320px]"><canvas id="line"></canvas></div>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  <section class="mb-10">
Â  Â  Â  <div class="flex items-end justify-between mb-3">
Â  Â  Â  Â  <h2 class="text-xl font-extrabold" data-i18n="holdingsTitle"></h2>
Â  Â  Â  Â  <div class="text-xs text-slate-500" data-i18n="holdingsSubtitle"></div>
Â  Â  Â  </div>
Â  Â  Â  <div id="holdings" class="grid grid-cols-1 md:grid-cols-2 gap-5"></div>
Â  Â  </section>

Â  Â  <section id="cash-holdings-section" class="mb-10">
Â  Â  Â  Â  <div class="flex items-end justify-between mb-3">
Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-extrabold" data-i18n="cashHoldingsTitle"></h2>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="cash-holdings" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"></div>
Â  Â  </section>

Â  Â  <footer class="text-center text-xs text-slate-500 pb-8 opacity-80" data-i18n="footer"></footer>
Â  </div>

Â  <script>
Â  Â  // ===================== CONFIG =====================
Â  Â  const POSITIONS_URL = "https://raw.githubusercontent.com/dookknl/finance-dashboard/main/docs/data/holdings/positions.csv";
Â  Â  const ASSETS_URL = "https://raw.githubusercontent.com/dookknl/finance-dashboard/main/docs/data/reference/assets.csv";
Â  Â  const PRICES_URL = "https://raw.githubusercontent.com/dookknl/finance-dashboard/main/docs/data/prices/prices_daily.csv";
Â  Â  const PEOPLE_URL = "https://raw.githubusercontent.com/dookknl/finance-dashboard/main/docs/data/reference/people.csv";

Â  Â  const REFRESH_MS = 5 * 60 * 1000;
Â  Â  const PEOPLE_MAP = {};
Â  Â  const PEOPLE_IDS = ['minchae', 'yeonu'];
Â  Â  let TARGET_PERSON = 'minchae';
Â  Â  let CURRENT_LANG = 'ko';
Â  Â  let switcherInterval = null;

Â  Â  // Global data stores
Â  Â  let investments = [];
Â  Â  let cashByCurrency = {};
Â  Â  const MM_THRESHOLD = 1000000; // 1 million

Â  Â  // Currency symbols map
Â  Â  const CURRENCY_SYMBOLS = {
Â  Â  Â  'KRW': 'â‚©',
Â  Â  Â  'USD': '$',
Â  Â  Â  'EUR': 'â‚¬',
Â  Â  Â  'JPY': 'Â¥',
Â  Â  Â  'CNY': 'Â¥'
Â  Â  };

Â  Â  const TRANSLATIONS = {
Â  Â  Â  ko: {
Â  Â  Â  Â  dashboardTitle: "ì˜ íˆ¬ì ëŒ€ì‹œë³´ë“œ",
Â  Â  Â  Â  lastUpdated: "ìµœê·¼ ì—…ë°ì´íŠ¸: â€”",
Â  Â  Â  Â  toggleTheme: "ë¼ì´íŠ¸/ë‹¤í¬ ì „í™˜",
Â  Â  Â  Â  fullScreen: "ì „ì²´ í™”ë©´",
Â  Â  Â  Â  autoOn: "â–¶ï¸",
Â  Â  Â  Â  autoOff: "â¸ï¸",
Â  Â  Â  Â  minchae: "ë¯¼ì±„",
Â  Â  Â  Â  yeonu: "Yeonu",
Â  Â  Â  Â  kpiTotalLabel: "ì´ í‰ê°€ì•¡",
Â  Â  Â  Â  kpiProfitLossLabel: "ì´ ì†ìµ",
Â  Â  Â  Â  kpiCashLabel: "ì´ í˜„ê¸ˆ",
Â  Â  Â  Â  kpiCashSubLabel: "ì•ˆì „ ìì‚°",
Â  Â  Â  Â  kpiCountLabel: "ë³´ìœ  ìì‚° ìˆ˜",
Â  Â  Â  Â  kpiCountSubLabel: "í€ë“œ + í˜„ê¸ˆ",
Â  Â  Â  Â  assetAllocationTitle: "ìì‚° ë°°ë¶„",
Â  Â  Â  Â  profitLossByAssetTitle: "ìì‚°ë³„ ì†ìµ",
Â  Â  Â  Â  portfolioTrendTitle: "í¬íŠ¸í´ë¦¬ì˜¤ ì¶”ì´",
Â  Â  Â  Â  holdingsTitle: "ë³´ìœ  ìì‚°",
Â  Â  Â  Â  holdingsSubtitle: "ì¹´ë“œë¥¼ íƒ­í•˜ë©´ ìƒì„¸ê°€ í¼ì³ì§‘ë‹ˆë‹¤",
Â  Â  Â  Â  cashHoldingsTitle: "í˜„ê¸ˆ ë³´ìœ ",
Â  Â  Â  Â  footer: "Â© for ë¯¼ì±„ Â· GitHub Pages & Google Sheets ì—°ë™",
Â  Â  Â  Â  fetchError: "ì˜¤ë¥˜: ë°ì´í„° íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. â€” íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.",
Â  Â  Â  Â  fetching: "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦",
Â  Â  Â  Â  price: "í˜„ì¬ê°€",
Â  Â  Â  Â  quantity: "ìˆ˜ëŸ‰",
Â  Â  Â  Â  cost: "í‰ë‹¨ê°€",
Â  Â  Â  Â  currentValue: "í˜„ì¬ í‰ê°€ì•¡",
Â  Â  Â  Â  profitLoss: "í˜„ì¬ ì†ìµ",
Â  Â  Â  Â  rateOfReturn: "ìˆ˜ìµë¥ ",
Â  Â  Â  Â  fundCode: "ì½”ë“œ",
Â  Â  Â  Â  noDateData: "ë‚ ì§œ ë°ì´í„° íƒì§€ ì•ˆ ë¨",
Â  Â  Â  Â  total: "ì´ê³„"
Â  Â  Â  },
Â  Â  Â  en: {
Â  Â  Â  Â  dashboardTitle: "'s Investment Dashboard",
Â  Â  Â  Â  lastUpdated: "Last Updated: â€”",
Â  Â  Â  Â  toggleTheme: "Toggle Theme",
Â  Â  Â  Â  fullScreen: "Full Screen",
Â  Â  Â  Â  autoOn: "â–¶ï¸",
Â  Â  Â  Â  autoOff: "â¸ï¸",
Â  Â  Â  Â  minchae: "Minchae",
Â  Â  Â  Â  yeonu: "Yeonu",
Â  Â  Â  Â  kpiTotalLabel: "Total Valuation",
Â  Â  Â  Â  kpiProfitLossLabel: "Total P/L",
Â  Â  Â  Â  kpiCashLabel: "Total Cash",
Â  Â  Â  Â  kpiCashSubLabel: "Safe Assets",
Â  Â  Â  Â  kpiCountLabel: "Total Holdings",
Â  Â  Â  Â  kpiCountSubLabel: "Funds + Cash",
Â  Â  Â  Â  assetAllocationTitle: "Asset Allocation",
Â  Â  Â  Â  profitLossByAssetTitle: "P/L by Asset",
Â  Â  Â  Â  portfolioTrendTitle: "Portfolio Trend",
Â  Â  Â  Â  holdingsTitle: "Holdings",
Â  Â  Â  Â  holdingsSubtitle: "Tap card for details",
Â  Â  Â  Â  cashHoldingsTitle: "Cash Holdings",
Â  Â  Â  Â  footer: "Â© for Minchae Â· GitHub Pages & Google Sheets Integration",
Â  Â  Â  Â  fetchError: "Error: Failed to load one or more data files. â€” Check your files.",
Â  Â  Â  Â  fetching: "Fetching dataâ€¦",
Â  Â  Â  Â  price: "Current Price",
Â  Â  Â  Â  quantity: "Quantity",
Â  Â  Â  Â  cost: "Cost per Unit",
Â  Â  Â  Â  currentValue: "Current Value",
Â  Â  Â  Â  profitLoss: "Current P/L",
Â  Â  Â  Â  rateOfReturn: "Return Rate",
Â  Â  Â  Â  fundCode: "Code",
Â  Â  Â  Â  noDateData: "No Date Data Detected",
Â  Â  Â  Â  total: "Total"
Â  Â  Â  }
Â  Â  };

Â  Â  // ===================== HELPERS =====================
Â  Â  const $ = (sel) => document.querySelector(sel);
Â  Â  const $$ = (sel) => document.querySelectorAll(sel);
Â  Â  const SAFE_CSV_SPLIT = /,(?=(?:[^"]*"[^"]*")*[^"]*$)/;

Â  Â  const nf = new Intl.NumberFormat('ko-KR');
Â  Â  const nfc = new Intl.NumberFormat('ko-KR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
Â  Â Â 
Â  Â  function formatCurrency(n, currency) {
Â  Â  Â  const symbol = CURRENCY_SYMBOLS[currency] || currency;
Â  Â  Â  return `${symbol}${nf.format(Math.round(n || 0))}`;
Â  Â  }

Â  Â  function toMM(n, currency) {
Â  Â  Â  const symbol = CURRENCY_SYMBOLS[currency] || currency;
Â  Â  Â  const formatted = nfc.format((n || 0) / 1_000_000);
Â  Â  Â  return `${symbol}${formatted} MM`;
Â  Â  }

Â  Â  function formatMMOrExact(n, currency) {
Â  Â  Â  if (Math.abs(n) < MM_THRESHOLD) {
Â  Â  Â  Â  return formatCurrency(n, currency);
Â  Â  Â  } else {
Â  Â  Â  Â  return toMM(n, currency);
Â  Â  Â  }
Â  Â  }

Â  Â  function showBanner(msg, tone='info') {
Â  Â  Â  const el = $('#status-banner');
Â  Â  Â  el.textContent = msg;
Â  Â  Â  el.className = `mb-4 rounded-2xl border px-4 py-3 text-sm`;
Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  el.classList.toggle('border-amber-200', tone==='info');
Â  Â  Â  el.classList.toggle('bg-amber-50', tone==='info');
Â  Â  Â  el.classList.toggle('text-amber-800', tone==='info');
Â  Â  Â  el.classList.toggle('border-red-200', tone==='error');
Â  Â  Â  el.classList.toggle('bg-red-50', tone==='error');
Â  Â  Â  el.classList.toggle('text-red-700', tone==='error');
Â  Â  Â  el.classList.remove('hidden');
Â  Â  }

Â  Â  function hideBanner(){ $('#status-banner').classList.add('hidden'); }
Â  Â  function setLastUpdated(){ $('#last-updated').textContent = `${TRANSLATIONS[CURRENT_LANG].lastUpdated.split(':')[0]}: ${new Date().toLocaleString(CURRENT_LANG === 'ko' ? 'ko-KR' : 'en-US')}`; }

Â  Â  function parseCSV(text) {
Â  Â  Â  Â  const rows = text.trim().split(/\r?\n/);
Â  Â  Â  Â  const headers = rows[0].split(SAFE_CSV_SPLIT).map(h => h.trim().replace(/"/g, ''));
Â  Â  Â  Â  const data = [];
Â  Â  Â  Â  for (let i = 1; i < rows.length; i++) {
Â  Â  Â  Â  Â  Â  const values = rows[i].split(SAFE_CSV_SPLIT).map(v => v.trim().replace(/"/g, ''));
Â  Â  Â  Â  Â  Â  const row = {};
Â  Â  Â  Â  Â  Â  headers.forEach((h, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  row[h] = values[idx];
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  data.push(row);
Â  Â  Â  Â  }
Â  Â  Â  Â  return data;
Â  Â  }

Â  Â  function applyTranslations(lang) {
Â  Â  Â  $$('[data-i18n]').forEach(el => {
Â  Â  Â  Â  const key = el.getAttribute('data-i18n');
Â  Â  Â  Â  let text = TRANSLATIONS[lang][key];
Â  Â  Â  Â  if (el.tagName === 'INPUT' || el.tagName === 'SELECT') {
Â  Â  Â  Â  Â  el.options.forEach(option => {
Â  Â  Â  Â  Â  Â  if (option.value === el.value) {
Â  Â  Â  Â  Â  Â  Â  option.textContent = text;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else if (el.tagName === 'OPTION') {
Â  Â  Â  Â  Â  el.textContent = text;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  el.textContent = text;
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  // Handle the dynamic title and button text
Â  Â  Â  renderDashboardTitle();
Â  Â  Â  const autoButton = $('#toggle-auto');
Â  Â  Â  autoButton.textContent = switcherInterval ? TRANSLATIONS[CURRENT_LANG].autoOff : TRANSLATIONS[CURRENT_LANG].autoOn;
Â  Â  Â Â 
Â  Â  Â  // Re-render everything with new language strings
Â  Â  Â  fetchDashboardData();
Â  Â  }
Â  Â Â 
Â  Â  // ===================== FETCH & PARSE =====================
Â  Â  async function fetchDashboardData() {
Â  Â  Â  Â  showBanner(TRANSLATIONS[CURRENT_LANG].fetching, 'info');
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const [positionsRes, assetsRes, pricesRes, peopleRes] = await Promise.all([
Â  Â  Â  Â  Â  Â  Â  fetch(POSITIONS_URL + `?t=${Date.now()}`),
Â  Â  Â  Â  Â  Â  Â  fetch(ASSETS_URL + `?t=${Date.now()}`),
Â  Â  Â  Â  Â  Â  Â  fetch(PRICES_URL + `?t=${Date.now()}`),
Â  Â  Â  Â  Â  Â  Â  fetch(PEOPLE_URL + `?t=${Date.now()}`),
Â  Â  Â  Â  Â  Â  ]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!positionsRes.ok || !assetsRes.ok || !pricesRes.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(TRANSLATIONS[CURRENT_LANG].fetchError);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (peopleRes.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  const peopleData = parseCSV(await peopleRes.text());
Â  Â  Â  Â  Â  Â  Â  Â  peopleData.forEach(p => PEOPLE_MAP[p.id] = p.name);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const positionsText = await positionsRes.text();
Â  Â  Â  Â  Â  Â  const assetsText = await assetsRes.text();
Â  Â  Â  Â  Â  Â  const pricesText = await pricesRes.text();

Â  Â  Â  Â  Â  Â  const positionsData = parseCSV(positionsText);
Â  Â  Â  Â  Â  Â  const assetsData = parseCSV(assetsText);
Â  Â  Â  Â  Â  Â  const pricesData = parseCSV(pricesText);

Â  Â  Â  Â  Â  Â  const personPositions = positionsData.filter(pos => pos.person_id === TARGET_PERSON);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const assetMap = new Map();
Â  Â  Â  Â  Â  Â  assetsData.forEach(asset => {
Â  Â  Â  Â  Â  Â  Â  Â  assetMap.set(asset.asset_id, asset);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const pricesMap = new Map();
Â  Â  Â  Â  Â  Â  pricesData.forEach(price => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!pricesMap.has(price.asset_id)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pricesMap.set(price.asset_id, []);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  pricesMap.get(price.asset_id).push({ date: price.date, close: Number(price.close) });
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Populate investments and cash holdings
Â  Â  Â  Â  Â  Â  investments = [];
Â  Â  Â  Â  Â  Â  cashByCurrency = {};
Â  Â  Â  Â  Â  Â  personPositions.forEach(pos => {
Â  Â  Â  Â  Â  Â  Â  Â  const assetRef = assetMap.get(pos.asset_id);
Â  Â  Â  Â  Â  Â  Â  Â  if (!assetRef) return;

Â  Â  Â  Â  Â  Â  Â  Â  if (assetRef.type === 'cash') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currency = assetRef.currency;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cashByCurrency[currency] = (cashByCurrency[currency] || 0) + Number(pos.qty);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const latestPrice = (pricesMap.get(pos.asset_id) || []).slice(-1)[0]?.close || Number(assetRef.current_price);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  investments.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: assetRef.short_name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fund_cd: pos.asset_id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  quantity: Number(pos.qty),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  purchasePrice: Number(pos.cost_per_unit),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPrice: latestPrice,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currency: assetRef.currency
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const timeline = buildTimeline(personPositions, pricesMap);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  renderAll(timeline);
Â  Â  Â  Â  Â  Â  setLastUpdated();
Â  Â  Â  Â  Â  Â  hideBanner();

Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  showBanner(e.message, 'error');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function buildTimeline(positions, pricesMap) {
Â  Â  Â  Â  const timeline = new Map();
Â  Â  Â  Â  const dates = new Set();

Â  Â  Â  Â  positions.forEach(pos => {
Â  Â  Â  Â  Â  Â  const assetPrices = pricesMap.get(pos.asset_id);
Â  Â  Â  Â  Â  Â  if (!assetPrices) return;

Â  Â  Â  Â  Â  Â  assetPrices.forEach(price => dates.add(price.date));
Â  Â  Â  Â  });

Â  Â  Â  Â  // [ìˆ˜ì •ëœ ë¶€ë¶„: YYYY-MM-DD -> YY-MM í¬ë§·ìœ¼ë¡œ ë³€ê²½]
Â  Â  Â  Â  const sortedDates = Array.from(dates)
            .sort()
            .map(date => {
                if (date && date.length >= 10) {
                    const year = date.substring(2, 4); // YY ì¶”ì¶œ
                    const month = date.substring(5, 7); // MM ì¶”ì¶œ
                    return `${year}-${month}`;
                }
                return date;
            });
Â  Â  Â  Â  // --------------------------------------------------------

Â  Â  Â  Â  sortedDates.forEach(date => {
Â  Â  Â  Â  Â  Â  let dailyValue = 0;
Â  Â  Â  Â  Â  Â  positions.forEach(pos => {
Â  Â  Â  Â  Â  Â  Â  Â  // Find the latest price for the asset up to this date
Â  Â  Â  Â  Â  Â  Â  Â  const pricesForAsset = pricesMap.get(pos.asset_id) || [];
Â  Â  Â  Â  Â  Â  Â  Â  // ì°¸ê³ : priceOnDate í•„í„°ë§ ë¡œì§ì€ ì—¬ì „íˆ 'YYYY-MM-DD' ì›ë³¸ ë‚ ì§œë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
Â  Â  Â  Â  Â  Â  Â  Â  const priceOnDate = pricesForAsset
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(p => {
                        // ë‚ ì§œ ë¹„êµë¥¼ ìœ„í•´ ì›ë³¸ ë‚ ì§œë¥¼ ì‚¬ìš© (YYYY-MM-DD)
                        const originalDate = p.date;
                        const targetDatePart = date; // YY-MM
                        return originalDate.startsWith(targetDatePart); // í•´ë‹¹ ì›”ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ í¬í•¨í•˜ë„ë¡ ë‹¨ìˆœí™”
                    })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b.date.localeCompare(a.date))[0];

Â  Â  Â  Â  Â  Â  Â  Â  if (priceOnDate) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dailyValue += Number(pos.qty) * priceOnDate.close;
Â  Â  Â  Â  Â  Â  Â  Â  } else if (pos.asset_id.startsWith('CASH')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dailyValue += Number(pos.qty); // Add cash amount
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  timeline.set(date, dailyValue);
Â  Â  Â  Â  });
Â  Â  Â 
Â  Â  return timeline;
Â  Â  }

Â  Â  // ===================== RENDER =====================
Â  Â  let donutChart, barsChart, lineChart;

Â  Â  function renderAll(timeline){
Â  Â  Â  renderDashboardTitle();
Â  Â  Â  renderKPIs();
Â  Â  Â  renderCashHoldings();
Â  Â  Â  renderHoldings();
Â  Â  Â  renderDonut();
Â  Â  Â  renderBars();
Â  Â  Â  renderLine(timeline);
Â  Â  }

Â  Â  function renderDashboardTitle(){
Â  Â  Â  const personName = PEOPLE_MAP[TARGET_PERSON] || TARGET_PERSON;
Â  Â  Â  $('#dashboard-title').textContent = `${personName}${TRANSLATIONS[CURRENT_LANG].dashboardTitle}`;
Â  Â  Â  $('#person-icon').textContent = personName.charAt(0).toUpperCase();
Â  Â  }

Â  Â  function calcTotals(){
Â  Â  Â  let totalVal = 0;
Â  Â  Â  let totalCost = 0;
Â  Â  Â  let totalCash = 0;
Â  Â  Â  for (const currency in cashByCurrency) {
Â  Â  Â  Â  Â  totalCash += cashByCurrency[currency]; // We'll assume cash values are in KRW for total calculation for now
Â  Â  Â  }
Â  Â  Â  totalVal += totalCash;
Â  Â  Â  totalCost += totalCash;
Â  Â  Â  for (const inv of investments){
Â  Â  Â  Â  const curVal = (inv.currentPrice||0) * inv.quantity;
Â  Â  Â  Â  const cost = inv.purchasePrice * inv.quantity;
Â  Â  Â  Â  totalVal += curVal;
Â  Â  Â  Â  totalCost += cost;
Â  Â  Â  }
Â  Â  Â  return { totalVal, totalCost, totalPL: totalVal - totalCost, totalCash: totalCash };
Â  Â  }

Â  Â  function renderKPIs(){
Â  Â  Â  const { totalVal, totalCost, totalPL, totalCash } = calcTotals();
Â  Â  Â  $('#kpi-total').textContent = formatMMOrExact(totalVal, 'KRW');
Â  Â  Â  $('#kpi-total-mm').textContent = formatCurrency(totalVal, 'KRW');
Â  Â  Â  $('#kpi-cash').textContent = formatMMOrExact(totalCash, 'KRW');
Â  Â  Â  $('#kpi-count').textContent = String(investments.length + Object.keys(cashByCurrency).length);

Â  Â  Â  const rate = totalCost > 0 ? (totalPL / totalCost) * 100 : 0;
Â  Â  Â  const plEl = $('#kpi-pl');
Â  Â  Â  plEl.textContent = `${totalPL >= 0 ? '+' : ''}${formatMMOrExact(Math.abs(totalPL), 'KRW')}`;
Â  Â  Â  const rateEl = $('#kpi-pl-rate');
Â  Â  Â  rateEl.textContent = `${TRANSLATIONS[CURRENT_LANG].rateOfReturn} ${rate >= 0 ? '+' : ''}${nfc.format(rate)}%`;
Â  Â  Â  plEl.classList.toggle('text-emerald-600', totalPL >= 0);
Â  Â  Â  plEl.classList.toggle('text-rose-600', totalPL < 0);
Â  Â  }

Â  Â  function renderCashHoldings() {
Â  Â  Â  Â  const wrap = $('#cash-holdings');
Â  Â  Â  Â  wrap.innerHTML = '';
Â  Â  Â  Â  if (Object.keys(cashByCurrency).length === 0) {
Â  Â  Â  Â  Â  Â  $('#cash-holdings-section').style.display = 'none';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  $('#cash-holdings-section').style.display = 'block';
Â  Â  Â  Â  Â  Â  for (const currency in cashByCurrency) {
Â  Â  Â  Â  Â  Â  Â  Â  const amount = cashByCurrency[currency];
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  card.className = 'bg-white dark:bg-slate-800 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-soft';
Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm text-slate-500 dark:text-slate-400">${TRANSLATIONS[CURRENT_LANG].kpiCashLabel} (${currency})</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-3xl font-extrabold mt-1 tracking-tight">${formatMMOrExact(amount, currency)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500 mt-1">${formatCurrency(amount, currency)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  wrap.appendChild(card);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderHoldings(){
Â  Â  Â  const wrap = $('#holdings');
Â  Â  Â  wrap.innerHTML = '';
Â  Â  Â  for (const inv of investments){
Â  Â  Â  Â  const curVal = inv.quantity * (inv.currentPrice||0);
Â  Â  Â  Â  const cost = inv.quantity * inv.purchasePrice;
Â  Â  Â  Â  const pl = curVal - cost;
Â  Â  Â  Â  const gain = pl >= 0;
Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  card.className = 'bg-white dark:bg-slate-800 rounded-2xl p-5 border border-slate-100 dark:border-slate-800 shadow-soft hover:shadow transition-all cursor-pointer';
Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  <div class="flex items-start justify-between gap-3">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <h3 class="text-lg font-bold">${inv.name}</h3>
Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500" data-i18n="fundCode">${TRANSLATIONS[CURRENT_LANG].fundCode}: ${inv.fund_cd}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="text-right">
Â  Â  Â  Â  Â  Â  Â  <div class="text-sm text-slate-500" data-i18n="currentValue">${TRANSLATIONS[CURRENT_LANG].currentValue}</div>
Â  Â  Â  Â  Â  Â  Â  <div class="text-xl font-extrabold">${formatMMOrExact(curVal, inv.currency)}</div>
Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-slate-500">${formatCurrency(curVal, inv.currency)}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="card-details mt-4 text-sm">
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-500" data-i18n="quantity">${TRANSLATIONS[CURRENT_LANG].quantity}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-semibold">${nf.format(inv.quantity)}</div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-500" data-i18n="cost">${TRANSLATIONS[CURRENT_LANG].cost}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-semibold">${formatCurrency(inv.purchasePrice, inv.currency)}</div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-500" data-i18n="price">${TRANSLATIONS[CURRENT_LANG].price}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-semibold">${inv.currentPrice ? formatCurrency(inv.currentPrice, inv.currency) : 'â€”'}</div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-slate-500" data-i18n="profitLoss">${TRANSLATIONS[CURRENT_LANG].profitLoss}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-semibold ${gain ? 'text-emerald-600' : 'text-rose-600'}">${gain ? '+' : ''}${formatCurrency(Math.abs(pl), inv.currency)}</div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  card.addEventListener('click', () => card.querySelector('.card-details').classList.toggle('visible'));
Â  Â  Â  Â  wrap.appendChild(card);
Â  Â  Â  }
Â  Â  }

Â  Â  function renderDonut(){
Â  Â  Â  const cashTotal = Object.values(cashByCurrency).reduce((sum, val) => sum + val, 0);
Â  Â  Â  const labels = [...investments.map(i => i.name), TRANSLATIONS[CURRENT_LANG].kpiCashLabel];
Â  Â  Â  const data = [
Â  Â  Â  Â  ...investments.map(i => i.quantity * (i.currentPrice || 0)),
Â  Â  Â  Â  cashTotal
Â  Â  Â  ];
Â  Â  Â  if (donutChart) donutChart.destroy();
Â  Â  Â  donutChart = new Chart($('#donut').getContext('2d'), {
Â  Â  Â  Â  type: 'doughnut',
Â  Â  Â  Â  data: { labels, datasets: [{ data }] },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true, maintainAspectRatio: false,
Â  Â  Â  Â  Â  plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: ctx => `${ctx.label}: ${formatMMOrExact(ctx.parsed, 'KRW')}` } } }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  function renderBars(){
Â  Â  Â  const labels = investments.map(i => i.name);

Â  Â  Â  // Calculate the current value and initial cost for each investment
Â  Â  Â  const currentValues = investments.map(i => i.quantity * (i.currentPrice || 0));
Â  Â  Â  const initialCosts = investments.map(i => i.quantity * i.purchasePrice);

Â  Â  Â  if (barsChart) barsChart.destroy();
Â  Â  Â  barsChart = new Chart($('#bars').getContext('2d'), {
Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  labels,
Â  Â  Â  Â  Â  // Add a separate dataset for current value
Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  label: 'Current Value (MM)',
Â  Â  Â  Â  Â  Â  data: currentValues,
Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(79, 70, 229, 0.8)', // Example color
Â  Â  Â  Â  Â  Â  borderColor: 'rgba(79, 70, 229, 1)',
Â  Â  Â  Â  Â  Â  borderWidth: 1
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  // Add a second dataset for initial cost
Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  label: 'Initial Cost (MM)',
Â  Â  Â  Â  Â  Â  data: initialCosts,
Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(107, 114, 128, 0.8)', // Example color for comparison
Â  Â  Â  Â  Â  Â  borderColor: 'rgba(107, 114, 128, 1)',
Â  Â  Â  Â  Â  Â  borderWidth: 1
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true, maintainAspectRatio: false,
Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  y: {
Â  Â  Â  Â  Â  Â  Â  beginAtZero: true,
Â  Â  Â  Â  Â  Â  Â  ticks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  callback: v => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Bar Chart Yì¶•ì€ ì´ì „ ìš”ì²­ëŒ€ë¡œ â‚©MM í¬ë§· ìœ ì§€
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formatted = (v / 1_000_000).toFixed(0); 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `${CURRENCY_SYMBOLS['KRW']}${formatted} MM`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  x: {
Â  Â  Â  Â  Â  Â  Â  // This ensures bars for the same fund are grouped together
Â  Â  Â  Â  Â  Â  Â  stacked: false
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: true }, // Show the legend to differentiate the datasets
Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  label: c => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formatted = (c.parsed.y / 1_000_000).toFixed(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return ` ${c.dataset.label}: ${CURRENCY_SYMBOLS['KRW']}${formatted} MM`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  function renderLine(timeline){
Â  Â  Â  const badge = $('#timeline-badge');
Â  Â  Â  // buildTimelineì—ì„œ Mapì˜ Keyë¡œ 'YY-MM' í¬ë§·ì´ ì €ì¥ë©ë‹ˆë‹¤.
Â  Â  Â  const labels = Array.from(timeline.keys()); 
Â  Â  Â  const data = Array.from(timeline.values());
Â  Â  Â Â 
Â  Â  Â  if (!timeline || timeline.size === 0 || labels.length === 0){
Â  Â  Â  Â  badge.textContent = TRANSLATIONS[CURRENT_LANG].noDateData;
Â  Â  Â  Â  if (lineChart) { lineChart.destroy(); lineChart = null; }
Â  Â  Â  Â  const ctx = $('#line').getContext('2d');
Â  Â  Â  Â  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  badge.textContent = `${labels[0]} ~ ${labels[labels.length - 1]}`;

Â  Â  Â  if (lineChart) lineChart.destroy();
Â  Â  Â  lineChart = new Chart($('#line').getContext('2d'), {
Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  labels,
Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  label: 'Total Value (MM)',
Â  Â  Â  Â  Â  Â  data,
Â  Â  Â  Â  Â  Â  borderColor: 'rgb(79, 70, 229)',
Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(79, 70, 229, 0.1)',
Â  Â  Â  Â  Â  Â  tension: 0.3,
Â  Â  Â  Â  Â  Â  fill: true
Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  y: {
Â  Â  Â  Â  Â  Â  Â  beginAtZero: false,
Â  Â  Â  Â  Â  Â  Â  ticks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  callback: v => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // [ìˆ˜ì •ëœ ë¶€ë¶„: Yì¶• XX.X MM í¬ë§·]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formatted = (v / 1_000_000).toFixed(1); // ì†Œìˆ˜ì  ì²«ì§¸ ìë¦¬ê¹Œì§€ í‘œì‹œ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `${CURRENCY_SYMBOLS['KRW']}${formatted} MM`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  x: {
Â  Â  Â  Â  Â  Â  Â  Â  ticks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Xì¶• í¬ë§·ì´ 'YY-MM'ìœ¼ë¡œ ì§§ì•„ì ¸ì„œ ê¸°ë³¸ ì„¤ì •ì„ ìœ ì§€í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  autoSkip: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxRotation: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minRotation: 0
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  plugins: {
Â  Â  Â  Â  Â  Â  legend: { display: false },
Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  label: c => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const formatted = (c.parsed.y / 1_000_000).toFixed(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return ` ${CURRENCY_SYMBOLS['KRW']}${formatted} MM`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  // ===================== INTERACTION =====================
Â  Â  function setPerson(personId) {
Â  Â  Â  TARGET_PERSON = personId;
Â  Â  Â  localStorage.setItem('targetPerson', personId);
Â  Â  Â  $('#person-select').value = personId; // Update the UI selector
Â  Â  Â  fetchDashboardData();
Â  Â  }
Â  Â Â 
Â  Â  function setLanguage(lang) {
Â  Â  Â  CURRENT_LANG = lang;
Â  Â  Â  localStorage.setItem('dashboardLang', lang);
Â  Â  Â  applyTranslations(lang);
Â  Â  }

Â  Â  function enterFullscreen(){
Â  Â  Â  const el = document.documentElement;
Â  Â  Â  if (el.requestFullscreen) el.requestFullscreen();
Â  Â  Â  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
Â  Â  Â  else if (el.msRequestFullscreen) el.msRequestFullscreen();
Â  Â  }

Â  Â  function applyStoredTheme(){
Â  Â  Â  const stored = localStorage.getItem('theme-mode');
Â  Â  Â  if (stored === 'dark') document.documentElement.classList.add('dark');
Â  Â  }

Â  Â  function toggleTheme(){
Â  Â  Â  const html = document.documentElement;
Â  Â  Â  html.classList.toggle('dark');
Â  Â  Â  localStorage.setItem('theme-mode', html.classList.contains('dark') ? 'dark' : 'light');
Â  Â  }

Â  Â  function toggleSwitcher() {
Â  Â  Â  Â  const button = $('#toggle-auto');
Â  Â  Â  Â  if (switcherInterval) {
Â  Â  Â  Â  Â  Â  clearInterval(switcherInterval);
Â  Â  Â  Â  Â  Â  switcherInterval = null;
Â  Â  Â  Â  Â  Â  button.textContent = TRANSLATIONS[CURRENT_LANG].autoOn;
Â  Â  Â  Â  Â  Â  localStorage.setItem('autoSwitchEnabled', 'false');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  switcherInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const currentIndex = PEOPLE_IDS.indexOf(TARGET_PERSON);
Â  Â  Â  Â  Â  Â  Â  Â  const nextIndex = (currentIndex + 1) % PEOPLE_IDS.length;
Â  Â  Â  Â  Â  Â  Â  Â  setPerson(PEOPLE_IDS[nextIndex]);
Â  Â  Â  Â  Â  Â  }, 15000); // 15 seconds
Â  Â  Â  Â  Â  Â  button.textContent = TRANSLATIONS[CURRENT_LANG].autoOff;
Â  Â  Â  Â  Â  Â  localStorage.setItem('autoSwitchEnabled', 'true');
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function populatePersonSelector() {
Â  Â  Â  Â  const selector = $('#person-select');
Â  Â  Â  Â  selector.innerHTML = '';
Â  Â  Â  Â  for (const id of PEOPLE_IDS) {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = id;
Â  Â  Â  Â  Â  Â  option.textContent = id.charAt(0).toUpperCase();
Â  Â  Â  Â  Â  Â  selector.appendChild(option);
Â  Â  Â  Â  }
Â  Â  Â  Â  selector.value = TARGET_PERSON;
Â  Â  }

Â  Â  // ===================== INIT =====================
Â  Â  window.addEventListener('load', () => {
Â  Â  Â  applyStoredTheme();
Â  Â  Â  const storedPerson = localStorage.getItem('targetPerson');
Â  Â  Â  if (storedPerson) {
Â  Â  Â  Â  TARGET_PERSON = storedPerson;
Â  Â  Â  } else {
Â  Â  Â  Â  localStorage.setItem('targetPerson', TARGET_PERSON);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const storedLang = localStorage.getItem('dashboardLang');
Â  Â  Â  if (storedLang) {
Â  Â  Â  Â  CURRENT_LANG = storedLang;
Â  Â  Â  Â  $('#lang-select').value = storedLang;
Â  Â  Â  } else {
Â  Â  Â  Â  localStorage.setItem('dashboardLang', CURRENT_LANG);
Â  Â  Â  }

Â  Â  Â  const autoSwitchEnabled = localStorage.getItem('autoSwitchEnabled');
Â  Â  Â  if (autoSwitchEnabled === 'true') {
Â  Â  Â  Â  toggleSwitcher();
Â  Â  Â  }

Â  Â  Â  populatePersonSelector();

Â  Â  Â  $('#toggleTheme').addEventListener('click', toggleTheme);
Â  Â  Â  $('#fullscreen-button').addEventListener('click', enterFullscreen);
Â  Â  Â  $('#person-select').addEventListener('change', (e) => setPerson(e.target.value));
Â  Â  Â  $('#lang-select').addEventListener('change', (e) => setLanguage(e.target.value));
Â  Â  Â  $('#toggle-auto').addEventListener('click', toggleSwitcher);
      // ë°ì´í„° ì´ˆê¸° ë¡œë“œ
      fetchDashboardData(); 
Â  Â  });
Â  </script>
</body>
</html>
